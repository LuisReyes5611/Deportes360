<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Administrar Productos</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"/>
    </h:head>
    <h:body>
        <f:event type="preRenderView" listener="#{productoBean.listar()}" />
        <h2 class="text-center text-primary">Administrar Productos</h2>
        <h:form>            
            <h:commandLink class="text-primary" value="Nuevo Producto" action="nuevo" />
            <h:commandLink style="margin-left: 15px;" class="text-danger" value="Menú Anterior" action="/faces/admin/index" />
            
            <h:commandLink style="margin-left: 15px; text-decoration: none;">
                <img src="../iconos/pdf.png" width="25"  />
                <p:dataExporter target="dtProds" type="pdf" fileName="Productos" />
            </h:commandLink>
            <h:commandLink style="margin-left: 15px; text-decoration: none;">
                <img src="../iconos/xls.png" width="25"  />
                <p:dataExporter target="dtProds" type="xls" fileName="Productos" />
            </h:commandLink>
            
            <p:dataTable id="dtProds" value="#{productoBean.listaProd}" filteredValue="#{productoBean.listaProdFilter}" 
                         var="prod" class="table table-bordered table-striped mt-3"
                         emptyMessage="No hay registros en la Base de Datos" >
                <p:column headerText="Código" filterBy="#{prod.cod}" sortBy="#{prod.cod}">                    
                    <h:outputText value="#{prod.cod}" />
                </p:column>
                
                <p:column filterBy="#{prod.nombre}" filterMatchMode="contains">
                    <f:facet name="header">
                        <h:outputLabel value="Nombre Producto"/>
                    </f:facet>
                    <h:outputText value="#{prod.nombre}" />
                </p:column>
                
                <p:column>
                    <f:facet name="header">
                        <h:outputLabel value="Descripción"/>
                    </f:facet>
                    <h:outputText value="#{prod.descr}" />
                </p:column>
                
                <p:column style="text-align: right;">
                    <f:facet name="header">
                        <h:outputLabel value="Precio"/>
                    </f:facet>
                    <h:outputText value="#{prod.precio}">
                        <f:convertNumber type="currency" currencySymbol="$" maxFractionDigits="0"/>
                    </h:outputText>
                </p:column>
                
                <p:column style="text-align: center;">
                    <f:facet name="header">
                        <h:outputLabel value="Existencias"/>
                    </f:facet>
                    <h:outputText value="#{prod.exist}" />
                </p:column>
                
                <p:column filterBy="#{prod.fven}" >
                    <f:facet name="header">
                        <h:outputLabel value="Fecha V."/>
                    </f:facet>
                    <h:outputText value="#{prod.fven}" />
                </p:column>
                
                <p:column exportable="false">
                    <f:facet name="header">
                        <h:outputLabel value="Imagen"/>
                    </f:facet>
                    <center>
                        <img src="#{prod.foto}" height="30" />
                    </center>                    
                </p:column>
                
                <p:column filterBy="#{prod.prov.nombre}" filterMatchMode="contains">
                    <f:facet name="header">
                        <h:outputLabel value="Proveedor"/>
                    </f:facet>
                    <h:outputText value="#{prod.prov.nombre}" />
                </p:column>
                
                <p:column exportable="false">
                    <f:facet name="header">
                        <h:outputLabel value="Opciones"/>
                    </f:facet>
                    <div align="center">
                        <h:commandLink class="text-success" value="Editar"  
                                       actionListener="#{productoBean.buscar(prod.id)}" action="editar" />
                        <h:commandLink class="text-danger" style="margin-left: 10px;" value="Eliminar"
                                       actionListener="#{productoBean.eliminar(prod.id)}" 
                                       onclick="return confirm('Está seguro de ELIMINAR el Producto #{prod.nombre} ??!!');" />
                    </div>
                </p:column>
                
            </p:dataTable>
        </h:form>
    </h:body>
</html>
